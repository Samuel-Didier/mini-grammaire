<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz de Fran√ßais - Choisissez votre d√©fi</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/assets/css/quiz.css"/>
</head>
<body>

<header>
    <h1>Quiz de Fran√ßais</h1>
    <p>Choisis un quiz pour commencer √† t'entra√Æner !</p>
</header>

<div class="container">

    <!--
        SECTION DU TEST DE NIVEAU
        Masqu√©e par d√©faut. S'affiche quand l'utilisateur clique sur "Test de Niveau".
    -->
    <div id="level-test" class="card hidden">
        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
            </div>
            <div class="progress-text" id="progress-text">Question 1 sur 10</div>
        </div>

        <div id="questions-container">
            <!-- Questions will be inserted here -->
        </div>

        <div id="question-nav">
            <button class="btn btn-primary" id="next-btn" disabled>Suivant</button>
        </div>
    </div>

    <!--
        SECTION DES R√âSULTATS
        Masqu√©e par d√©faut. S'affiche √† la fin du test de niveau.
    -->
    <div id="results" class="card result-container hidden">
        <div class="result-icon">üéâ</div>
        <h2 class="result-title">Test Termin√© !</h2>
        <div class="result-level" id="result-level">Niveau B1</div>
        <p class="result-score" id="result-score">Tu as obtenu -/10</p>

        <div class="result-details">
            <h3>üìä R√©sum√©</h3>
            <p><strong>Questions r√©pondues:</strong> <span id="total-answered">0</span>/10</p>
            <p><strong>R√©ponses correctes:</strong> <span id="correct-count">0</span></p>
            <p><strong>Temps total:</strong> <span id="total-time">0</span> secondes</p>
            <p><strong>Niveau d√©termin√©:</strong> <span id="determined-level">-</span></p>
        </div>

        <button class="btn btn-primary" onclick="showQuizMenu()">Retour au menu</button>
    </div>

    <!--
        MENU DE S√âLECTION DES QUIZ
        Affich√© par d√©faut au chargement de la page.
    -->
    <div id="quiz-menu" class="card quiz-menu active">
        <h2 style="text-align: center; margin-bottom: 30px;">üìö Choisis ton Quiz</h2>

        <!-- Cat√©gorie : Tests de Niveau -->
        <div class="quiz-category">
            <h3>üéØ Tests de Niveau</h3>
            <div class="quiz-buttons">
                <div class="quiz-btn" onclick="startLevelTest()">
                    <div class="quiz-btn-icon">üìù</div>
                    <div class="quiz-btn-title">Test de Niveau</div>
                    <div class="quiz-btn-desc">10 questions</div>
                </div>
            </div>
        </div>

        <!-- Cat√©gorie : Grammaire -->
        <div class="quiz-category">
            <h3>üìñ Grammaire</h3>
            <div class="quiz-buttons">
                <div class="quiz-btn" onclick="startQuiz('grammaire', 'a1')">
                    <div class="quiz-btn-icon">üìù</div>
                    <div class="quiz-btn-title">A1 - D√©butant</div>
                    <div class="quiz-btn-desc">Les bases</div>
                </div>
                <div class="quiz-btn" onclick="startQuiz('grammaire', 'a2')">
                    <div class="quiz-btn-icon">üìù</div>
                    <div class="quiz-btn-title">A2 - √âl√©mentaire</div>
                    <div class="quiz-btn-desc">Communication simple</div>
                </div>
                <div class="quiz-btn" onclick="startQuiz('grammaire', 'b1')">
                    <div class="quiz-btn-icon">üìù</div>
                    <div class="quiz-btn-title">B1 - Interm√©diaire</div>
                    <div class="quiz-btn-desc">S'exprimer clairement</div>
                </div>
                <div class="quiz-btn" onclick="startQuiz('grammaire', 'b2')">
                    <div class="quiz-btn-icon">üìù</div>
                    <div class="quiz-btn-title">B2 - Avanc√©</div>
                    <div class="quiz-btn-desc">Complexit√© nuanc√©e</div>
                </div>
            </div>
        </div>

        <!-- Cat√©gorie : Vocabulaire -->
        <div class="quiz-category">
            <h3>üó£Ô∏è Vocabulaire</h3>
            <div class="quiz-buttons">
                <div class="quiz-btn" onclick="startQuiz('vocabulaire', 'a1')">
                    <div class="quiz-btn-icon">üí¨</div>
                    <div class="quiz-btn-title">A1 - Quotidien</div>
                    <div class="quiz-btn-desc">Mots essentiels</div>
                </div>
                <div class="quiz-btn" onclick="startQuiz('vocabulaire', 'a2')">
                    <div class="quiz-btn-icon">üí¨</div>
                    <div class="quiz-btn-title">A2 - Courant</div>
                    <div class="quiz-btn-desc">Vie quotidienne</div>
                </div>
                <div class="quiz-btn" onclick="startQuiz('vocabulaire', 'b1')">
                    <div class="quiz-btn-icon">üí¨</div>
                    <div class="quiz-btn-title">B1 - √âtendu</div>
                    <div class="quiz-btn-desc">Sujets vari√©s</div>
                </div>
            </div>
        </div>

        <!-- Cat√©gorie : Compr√©hension -->
        <div class="quiz-category">
            <h3>üëÇ Compr√©hension</h3>
            <div class="quiz-buttons">
                <div class="quiz-btn" onclick="startQuiz('comprehension', 'a1')">
                    <div class="quiz-btn-icon">üëÇ</div>
                    <div class="quiz-btn-title">A1 - √âcrite</div>
                    <div class="quiz-btn-desc">Textes simples</div>
                </div>
                <div class="quiz-btn" onclick="startQuiz('comprehension', 'a2')">
                    <div class="quiz-btn-icon">üëÇ</div>
                    <div class="quiz-btn-title">A2 - Orale</div>
                    <div class="quiz-btn-desc">Dialogues</div>
                </div>
                <div class="quiz-btn" onclick="startQuiz('comprehension', 'b1')">
                    <div class="quiz-btn-icon">üëÇ</div>
                    <div class="quiz-btn-title">B1 - Avanc√©e</div>
                    <div class="quiz-btn-desc">Textes complexes</div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // ==========================================
    // DONN√âES DU QUIZ
    // ==========================================
    const levelTestQuestions = [
        { level: 'a1', question: "Comment dit-on 'Hello' en fran√ßais ?", options: ["Bonjour", "Au revoir", "Merci", "Bonsoir"], correct: 0 },
        { level: 'a1', question: "Compl√®tez : 'Je ___ fran√ßais.'", options: ["suis", "es", "sommes", "√™tes"], correct: 0 },
        { level: 'a2', question: "Quel temps fait-il ? 'Il ___ beaucoup.'", options: ["fait", "fait beau", "pleut", "y a"], correct: 2 },
        { level: 'a2', question: "Compl√©tez : 'Nous ___ aller au cin√©ma ce soir.'", options: ["allons", "aller", "allez", "va"], correct: 0 },
        { level: 'b1', question: "Compl√©tez : 'Si tu ___ riche, tu voyagerais.'", options: ["es", "serais", "√©tais", "seras"], correct: 2 },
        { level: 'b1', question: "Quel est le participe pass√© de 'finir' ?", options: ["finissant", "fini", "finie", "finirez"], correct: 1 },
        { level: 'b2', question: "Choisissez le subjonctif : 'Il faut que tu ___ ton travail.'", options: ["fais", "fasses", "fait", "faire"], correct: 1 },
        { level: 'b2', question: "Identifiez le mode verbal : 'Pourvu qu'il vienne!'", options: ["Indicatif", "Subjonctif", "Conditionnel", "Imp√©ratif"], correct: 1 },
        { level: 'c1', question: "Identifiez la figure de style : 'La nuit, les chats sont gris.'", options: ["M√©taphore", "Personnification", "Oxymore", "Euph√©misme"], correct: 2 },
        { level: 'c1', question: "Choisissez le bon registre : 'Je t'aime' (registre litt√©raire)", options: ["Je t'affectionne", "Je t'adore", "Mon c≈ìur palpite pour toi", "Je te suis attach√©"], correct: 2 }
    ];

    const quizDatabase = {
        grammaire: {
            a1: [ { question: "Quel est le f√©minin de 'grand' ?", options: ["grande", "gr√∂√üer", "grandir", "grandi"], correct: 0 } ],
            a2: [ { question: "Le pass√© compos√© de 'aller' est :", options: ["all√©", "suis all√©", "√©tais all√©", "ai alll√©"], correct: 1 } ],
            b1: [ { question: "Le plus-que-parfait de 'finir' :", options: ["avait fini", "eut fini", "aurait fini", "finissait"], correct: 0 } ],
            b2: [ { question: "Le subjonctif apr√®s 'il faut que' :", options: ["infinitif", "conditionnel", "subjonctif", "indicatif"], correct: 2 } ]
        },
        vocabulaire: {
            a1: [ { question: "'La maison' en anglais :", options: ["mouse", "house", "mouse", "spouse"], correct: 1 } ],
            a2: [ { question: "'Faire les courses' signifie :", options: ["faire du sport", "acheter des provisions", "courir", "faire la cuisine"], correct: 1 } ],
            b1: [ { question: "'Par ailleurs' est un connecteur de :", options: ["temps", "addition", "opposition", "cause"], correct: 1 } ]
        },
        comprehension: {
            a1: [ { question: "Texte : 'Je m'appelle Marie. J'ai 20 ans.' Quel √¢ge a Marie ?", options: ["10 ans", "20 ans", "30 ans", "25 ans"], correct: 1 } ],
            a2: [ { question: "Dialogue : 'O√π est la gare ? - C'est √† droite.' La gare est :", options: ["√† gauche", "√† droite", "devant", "derri√®re"], correct: 1 } ],
            b1: [ { question: "Article : 'Malgr√© la crise, l'√©conomie croissance.' Le contexte est :", options: ["n√©gatif", "positif", "neutre", "inconnu"], correct: 1 } ]
        }
    };

    // ==========================================
    // √âTAT DE L'APPLICATION
    // ==========================================
    let currentQuestion = 0;
    let answers = [];
    let startTime = null;
    let isQuizMode = false;
    let currentQuizCategory = null;
    let currentQuizLevel = null;

    // √âl√©ments du DOM
    const levelTest = document.getElementById('level-test');
    const questionsContainer = document.getElementById('questions-container');
    const progressFill = document.getElementById('progress-fill');
    const progressText = document.getElementById('progress-text');
    const nextBtn = document.getElementById('next-btn');
    const results = document.getElementById('results');
    const quizMenu = document.getElementById('quiz-menu');

    // ==========================================
    // FONCTIONS PRINCIPALES
    // ==========================================

    // Initialisation au chargement
    function init() {
        showQuizMenu();
    }

    // Affiche la question actuelle
    function showQuestion() {
        const questions = isQuizMode ? quizDatabase[currentQuizCategory][currentQuizLevel] : levelTestQuestions;
        const q = questions[currentQuestion];

        const letters = ['A', 'B', 'C', 'D'];

        let html = `
                <div class="question-container active">
                    <div class="question-number">Question ${currentQuestion + 1}</div>
                    <div class="question-text">${q.question}</div>
                    <div class="options">
            `;

        q.options.forEach((option, index) => {
            html += `
                    <div class="option" data-index="${index}" onclick="selectOption(${index})">
                        <span class="option-letter">${letters[index]}</span>
                        <span>${option}</span>
                    </div>
                `;
        });

        html += `</div></div>`;
        questionsContainer.innerHTML = html;
        updateProgress();
    }

    // Met √† jour la barre de progression
    function updateProgress() {
        const questions = isQuizMode ? quizDatabase[currentQuizCategory][currentQuizLevel] : levelTestQuestions;
        const progress = ((currentQuestion + 1) / questions.length) * 100;
        progressFill.style.width = `${progress}%`;
        progressText.textContent = `Question ${currentQuestion + 1} sur ${questions.length}`;
    }

    // G√®re la s√©lection d'une r√©ponse
    function selectOption(index) {
        const options = document.querySelectorAll('.option');
        options.forEach(opt => opt.classList.remove('selected'));
        options[index].classList.add('selected');
        nextBtn.disabled = false;
        answers[currentQuestion] = index;
    }

    // Gestion du clic sur "Suivant"
    nextBtn.addEventListener('click', () => {
        const questions = isQuizMode ? quizDatabase[currentQuizCategory][currentQuizLevel] : levelTestQuestions;

        if (currentQuestion < questions.length - 1) {
            currentQuestion++;
            showQuestion();
            nextBtn.disabled = true;
        } else {
            if (isQuizMode) {
                showQuizResults();
            } else {
                showResults();
            }
        }
    });

    // Affiche les r√©sultats du test de niveau
    function showResults() {
        const endTime = Date.now();
        const timeTaken = Math.round((endTime - startTime) / 1000);

        let correctCount = 0;
        let levelScores = { a1: 0, a2: 0, b1: 0, b2: 0, c1: 0 };

        levelTestQuestions.forEach((q, i) => {
            if (answers[i] === q.correct) {
                correctCount++;
                levelScores[q.level]++;
            }
        });

        // Algorithme de d√©termination du niveau
        let determinedLevel = 'A1';
        const maxScore = Math.max(...Object.values(levelScores));

        if (levelScores.c1 >= 2 && maxScore === levelScores.c1) determinedLevel = 'C1';
        else if (levelScores.b2 >= 2 && maxScore >= levelScores.b2) determinedLevel = 'B2';
        else if (levelScores.b1 >= 2 && maxScore >= levelScores.b1) determinedLevel = 'B1';
        else if (levelScores.a2 >= 2 && maxScore >= levelScores.a2) determinedLevel = 'A2';

        const questions = levelTestQuestions.length;

        document.getElementById('result-level').textContent = `Niveau ${determinedLevel}`;
        document.getElementById('result-score').textContent = `Tu as obtenu ${correctCount}/${questions}`;
        document.getElementById('total-answered').textContent = questions;
        document.getElementById('correct-count').textContent = correctCount;
        document.getElementById('total-time').textContent = timeTaken;
        document.getElementById('determined-level').textContent = determinedLevel;

        levelTest.classList.add('hidden');
        results.classList.remove('hidden');
        results.classList.add('active');

        createConfetti();
    }

    // Affiche les r√©sultats d'un quiz sp√©cifique
    function showQuizResults() {
        const questions = quizDatabase[currentQuizCategory][currentQuizLevel];
        let correctCount = 0;

        questions.forEach((q, i) => {
            if (answers[i] === q.correct) correctCount++;
        });

        const percentage = Math.round((correctCount / questions.length) * 100);

        alert(`Quiz termin√© !\n\nScore: ${correctCount}/${questions.length} (${percentage}%)\n\nNiveau: ${currentQuizLevel.toUpperCase()}`);

        showQuizMenu();
    }

    // Cr√©e l'effet visuel de confettis
    function createConfetti() {
        const colors = ['#6366f1', '#f59e0b', '#10b981', '#ef4444', '#8b5cf6'];

        for (let i = 0; i < 50; i++) {
            const confetti = document.createElement('div');
            confetti.className = 'confetti';
            confetti.style.left = Math.random() * 100 + 'vw';
            confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
            confetti.style.animationDelay = Math.random() * 3 + 's';
            confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
            document.body.appendChild(confetti);
        }

        setTimeout(() => {
            document.querySelectorAll('.confetti').forEach(c => c.remove());
        }, 5000);
    }

    // Affiche le menu de s√©lection des quiz
    function showQuizMenu() {
        results.classList.add('hidden');
        levelTest.classList.add('hidden');
        quizMenu.classList.remove('hidden');
        quizMenu.classList.add('active');
    }

    // D√©marre le test de niveau
    function startLevelTest() {
        isQuizMode = false;
        currentQuestion = 0;
        answers = new Array(levelTestQuestions.length).fill(null);
        startTime = Date.now();

        quizMenu.classList.add('hidden');
        results.classList.add('hidden');
        levelTest.classList.remove('hidden');
        levelTest.classList.add('active');

        showQuestion();
    }

    // D√©marre un quiz sp√©cifique
    function startQuiz(category, level) {
        if (!quizDatabase[category] || !quizDatabase[category][level]) {
            alert('Ce quiz arrive bient√¥t !');
            return;
        }

        isQuizMode = true;
        currentQuizCategory = category;
        currentQuizLevel = level;
        currentQuestion = 0;
        const questions = quizDatabase[category][level];
        answers = new Array(questions.length).fill(null);

        quizMenu.classList.add('hidden');
        results.classList.add('hidden');
        levelTest.classList.remove('hidden');
        levelTest.classList.add('active');

        showQuestion();
        nextBtn.disabled = true;
    }

    // Lancement au chargement de la page
    document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>